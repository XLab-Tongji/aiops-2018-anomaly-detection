## Report For Our Method

### 方法

1. 特征工程
2. VAE生成异常数据用来平衡正负样本分布差异
3. Deep Neural Network训练数据
4. 调整threshold进一步提升模型的表现效果

### 特征工程

见孙韬的报告

### VAE生成异常数据

通过VAE生成模型生成新的异常样本点，从而平衡数据分布，可以使用binary cross entropy训练模型。我觉得华为汇报的PPT里面那张图画的模型结构图挺好的～

### 网络结构

<img src="fig/dnn_model.png">

### 调整threshold从而让模型达到最好的数据集表现

通过plot出threshold关于f1 score的曲线 从而确定出threshold的最优取值，如下图

<img src="fig/find_f1.png">

### 最终结果

我们分别在26个不同kpi数据集上测试了模型的结果，每个kpi结果如下图所示：

|      kpi_id      | accuracy | f1_score | precision | recall |
| :--------------: | :------: | :------: | :-------: | :----: |
| 09513ae3e75778a3 |  0.9969  |  0.2957  |   0.34    | 0.2615 |
| 769894baefea4e9e |  0.0006  |  0.0000  |  0.0000   | 0.0006 |
| 71595dd7171f4540 |  0.9972  |  0.8128  |  0.8318   | 0.7946 |
| 18fbb1d5a5dc099d |  0.9975  |  0.9795  |  0.9706   | 0.9885 |
| 88cf3a776ba00e7c |  0.9785  |  0.7896  |  0.7967   | 0.7825 |
| a40b1df87e3f1c87 |  0.9994  |  0.8874  |  0.9054   | 0.8701 |
| 40e25005ff8992bd |  0.9985  |  0.883   |  0.9286   | 0.8417 |
| 046ec29ddf80d62e |  0.9824  |  0.4918  |  0.8824   | 0.3409 |
| 9bd90500bfd11edb |  0.9999  |  0.9508  |  0.9355   | 0.9667 |
| 9ee5879409dccef9 |  0.9735  |  0.7116  |   0.774   | 0.6585 |
| 8bef9af9a922e0b3 |  0.9983  |  0.7887  |  0.7636   | 0.8155 |
| 07927a9a18fa19ae |  0.9932  |  0.7273  |   0.625   | 0.8696 |
| 1c35dbf57f55f5e4 |  0.9931  |  0.9543  |  0.9533   | 0.9552 |
| c58bfcbacb2822d1 |  0.9986  |  0.3509  |  0.3333   | 0.3704 |
| affb01ca2b4f0b45 |  0.9984  |  0.8209  |  0.7801   | 0.8661 |
| 02e99bd4f6cfb33f |  0.9624  |  0.7782  |  0.7829   | 0.7736 |
| 8a20c229e9860d0c |    0     |  0.000   |     0     |   0    |
| a5bf5d65261d859a |  0.9999  |  0.9091  |  0.9091   | 0.9091 |
| da403e4e3f87c9e0 |  0.9996  |  0.9965  |  0.9968   | 0.9962 |
| 7c189dd36f048a6c |  0.9991  |  0.8462  |  0.8462   | 0.8462 |
| 54e8a140f6237526 |  0.0006  |  0.0012  |     1     | 0.0006 |
| e0770391decc44ce |  0.9984  |  0.9635  |  0.9681   | 0.9589 |
| cff6d3c01e6a6bfa |  0.9978  |  0.8429  |  0.8233   | 0.8634 |
| 8c892e5525f3e491 |  0.9988  |  0.9709  |   0.982   |  0.96  |
| 76f4550c43334374 |  0.9824  |  0.4561  |  0.7647   | 0.325  |
| b3b2e6d1a791d63a |  0.0006  |  0.0000  |  0.0000   | 0.0006 |

注意到上述存在4个kpi id的数据集f1为0的情况 这里我们认为是测试集label全为0 所以导致计算出现问题，非代码bug。由数据大小加权得模型在整体数据集f1 score为0.80。